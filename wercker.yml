box: node
build:
  steps:
    - npm-install
    - npm-test

push:
  steps:
    - internal/docker-push:
        username: $USERNAME
        password: $PASSWORD
        repository: stevemostovoy/lunch-roulette
        tag: $WERCKER_GIT_COMMIT
        ports: "8000"
        env: "PORT=8000"
        entrypoint: "node src/index.js"

deploy-rancher:
  steps:
    - swaggy/deploy-to-rancher:
        access_key: $RANCHER_ACCESS_KEY
        secret_key: $RANCHER_SECRET_KEY
        rancher_url: $RANCHER_URL
        https: true
        tag: $WERCKER_GIT_COMMIT
        stack_name: LunchRoulette
        service_name: lunch-roulette
        docker_org: stevemostovoy
        docker_image: lunch-roulette
        use_tag: true
        inplace: true
